<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WildBot HFT Scalper</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    background: #1a1b26;
    color: #c0caf5;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    padding: 20px;
    min-height: 100vh;
  }
  .mono { font-family: 'JetBrains Mono', 'Fira Code', 'Consolas', monospace; }
  header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 24px;
    padding-bottom: 16px;
    border-bottom: 1px solid #363b54;
  }
  header h1 { font-size: 1.5rem; font-weight: 600; }
  .status-dot {
    width: 12px; height: 12px;
    border-radius: 50%;
    background: #f7768e;
    flex-shrink: 0;
  }
  .status-dot.running { background: #9ece6a; box-shadow: 0 0 8px #9ece6a88; }
  .status-label { font-size: 0.85rem; color: #565f89; }
  .mode-badge {
    display: inline-block;
    padding: 3px 12px;
    border-radius: 4px;
    font-size: 0.75rem;
    font-weight: 700;
    letter-spacing: 0.05em;
  }
  .mode-live { background: #f7768e22; color: #f7768e; border: 1px solid #f7768e55; }
  .mode-paper { background: #565f8922; color: #565f89; border: 1px solid #565f8955; }
  .grid { display: grid; gap: 12px; margin-bottom: 20px; }
  .grid-4 { grid-template-columns: repeat(4, 1fr); }
  .grid-5 { grid-template-columns: repeat(5, 1fr); }
  .card {
    background: #24283b;
    border-radius: 10px;
    padding: 16px;
  }
  .card-label {
    font-size: 0.7rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: #565f89;
    margin-bottom: 4px;
  }
  .card-value {
    font-size: 1.3rem;
    font-weight: 600;
    transition: color 0.3s;
  }
  .section-title {
    font-size: 0.85rem;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: #565f89;
    margin-bottom: 10px;
    font-weight: 600;
  }
  .green { color: #9ece6a; }
  .red { color: #f7768e; }
  .blue { color: #7aa2f7; }
  .yellow { color: #e0af68; }
  .purple { color: #bb9af7; }
  .info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    gap: 10px;
  }
  .info-item {
    background: #24283b;
    border-radius: 8px;
    padding: 12px;
    display: flex;
    flex-direction: column;
    gap: 3px;
  }
  .info-label { font-size: 0.68rem; text-transform: uppercase; color: #565f89; letter-spacing: 0.04em; }
  .info-value { font-size: 0.95rem; font-weight: 500; }
  .status-reason-bar {
    background: #24283b;
    border-radius: 10px;
    padding: 16px;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 16px;
    flex-wrap: wrap;
  }
  .status-reason-badge {
    display: inline-block;
    padding: 6px 16px;
    border-radius: 6px;
    font-size: 0.9rem;
    font-weight: 700;
    letter-spacing: 0.05em;
    text-transform: uppercase;
  }
  .reason-active { background: #9ece6a22; color: #9ece6a; border: 1px solid #9ece6a55; }
  .reason-waiting_fill { background: #7aa2f722; color: #7aa2f7; border: 1px solid #7aa2f755; }
  .reason-volatility_low { background: #e0af6822; color: #e0af68; border: 1px solid #e0af6855; }
  .reason-spread_wide { background: #e0af6822; color: #e0af68; border: 1px solid #e0af6855; }
  .reason-drawdown_stopped { background: #f7768e22; color: #f7768e; border: 1px solid #f7768e55; }
  .reason-cooldown { background: #bb9af722; color: #bb9af7; border: 1px solid #bb9af755; }
  .reason-time_stop { background: #f7768e22; color: #f7768e; border: 1px solid #f7768e55; }
  .reason-stop_loss { background: #f7768e22; color: #f7768e; border: 1px solid #f7768e55; }
  .reason-initializing { background: #565f8922; color: #565f89; border: 1px solid #565f8955; }
  .spread-info {
    font-size: 0.82rem;
    color: #c0caf5;
  }
  .spread-info span { margin-right: 16px; }
  .stopped-badge {
    display: inline-block;
    background: #f7768e22;
    color: #f7768e;
    padding: 2px 10px;
    border-radius: 4px;
    font-size: 0.85rem;
    font-weight: 600;
  }
  .momentum-badge {
    display: inline-block;
    padding: 2px 10px;
    border-radius: 4px;
    font-size: 0.8rem;
    font-weight: 600;
  }
  .momentum-up { background: #9ece6a22; color: #9ece6a; }
  .momentum-down { background: #f7768e22; color: #f7768e; }
  .momentum-neutral { background: #565f8922; color: #565f89; }
  .trade-table-wrap {
    background: #24283b;
    border-radius: 10px;
    padding: 16px;
    margin-bottom: 20px;
    overflow-x: auto;
  }
  .trade-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.82rem;
  }
  .trade-table th {
    text-align: left;
    padding: 8px 10px;
    color: #565f89;
    font-size: 0.7rem;
    text-transform: uppercase;
    letter-spacing: 0.04em;
    border-bottom: 1px solid #363b54;
  }
  .trade-table td {
    padding: 6px 10px;
    border-bottom: 1px solid #1a1b26;
  }
  .trade-table tr:last-child td { border-bottom: none; }
  .trade-table .buy-row { color: #9ece6a; }
  .trade-table .sell-row { color: #f7768e; }
  .empty-trades {
    color: #565f89;
    text-align: center;
    padding: 24px;
    font-size: 0.85rem;
  }
  @media (max-width: 900px) {
    .grid-4 { grid-template-columns: repeat(2, 1fr); }
    .grid-5 { grid-template-columns: repeat(2, 1fr); }
  }
  @media (max-width: 480px) {
    .grid-4 { grid-template-columns: 1fr; }
    .grid-5 { grid-template-columns: 1fr; }
  }
</style>
</head>
<body>
<header>
  <div class="status-dot" id="statusDot"></div>
  <h1>WildBot HFT Scalper</h1>
  <span class="status-label" id="statusLabel">connecting...</span>
  <span class="mode-badge" id="modeBadge">—</span>
</header>

<div class="status-reason-bar" id="statusReasonBar">
  <span class="status-reason-badge reason-initializing" id="statusReasonBadge">INITIALIZING</span>
  <div class="spread-info">
    <span>Spread: <strong class="mono" id="spreadBps">—</strong> bps</span>
    <span>Exit Target: <strong class="mono" id="minEdgeBps">—</strong> bps</span>
    <span>Fee/RT: <strong class="mono" id="feeBps">—</strong> bps</span>
    <span>Volatility: <strong class="mono" id="volBps">—</strong> bps</span>
  </div>
</div>

<div class="grid grid-4">
  <div class="card">
    <div class="card-label">Balance</div>
    <div class="card-value mono" id="balance">—</div>
  </div>
  <div class="card">
    <div class="card-label">Equity</div>
    <div class="card-value mono" id="equity">—</div>
  </div>
  <div class="card">
    <div class="card-label">Return %</div>
    <div class="card-value mono" id="returnPct">—</div>
  </div>
  <div class="card">
    <div class="card-label">Trade Count</div>
    <div class="card-value mono blue" id="tradeCount">—</div>
  </div>
</div>

<div class="grid grid-5">
  <div class="card">
    <div class="card-label">Realized PnL</div>
    <div class="card-value mono" id="realizedPnl">—</div>
  </div>
  <div class="card">
    <div class="card-label">Unrealized PnL</div>
    <div class="card-value mono" id="unrealizedPnl">—</div>
  </div>
  <div class="card">
    <div class="card-label">Win / Loss</div>
    <div class="card-value mono" id="winLoss">—</div>
  </div>
  <div class="card">
    <div class="card-label">Win Rate %</div>
    <div class="card-value mono" id="winRate">—</div>
  </div>
  <div class="card">
    <div class="card-label">Max Drawdown %</div>
    <div class="card-value mono red" id="maxDrawdown">—</div>
  </div>
</div>

<div class="section-title">Market Data</div>
<div class="info-grid" style="margin-bottom:20px;">
  <div class="info-item">
    <span class="info-label">Symbol</span>
    <span class="info-value blue" id="symbol">—</span>
  </div>
  <div class="info-item">
    <span class="info-label">Best Bid</span>
    <span class="info-value mono green" id="bestBid">—</span>
  </div>
  <div class="info-item">
    <span class="info-label">Best Ask</span>
    <span class="info-value mono red" id="bestAsk">—</span>
  </div>
  <div class="info-item">
    <span class="info-label">Spread (bps)</span>
    <span class="info-value mono" id="spread">—</span>
  </div>
  <div class="info-item">
    <span class="info-label">Microprice</span>
    <span class="info-value mono purple" id="microprice">—</span>
  </div>
  <div class="info-item">
    <span class="info-label">Position</span>
    <span class="info-value mono" id="position">—</span>
  </div>
  <div class="info-item">
    <span class="info-label">Avg Entry</span>
    <span class="info-value mono yellow" id="avgEntry">—</span>
  </div>
  <div class="info-item">
    <span class="info-label">Open Orders</span>
    <span class="info-value mono blue" id="openOrders">—</span>
  </div>
</div>

<div class="section-title">Pair Scanner</div>
<div class="trade-table-wrap" style="margin-bottom:20px;">
  <div style="display:flex;gap:20px;margin-bottom:12px;flex-wrap:wrap;">
    <div class="info-item" style="flex:1;min-width:140px;">
      <span class="info-label">Active Pair</span>
      <span class="info-value mono green" id="activePair">—</span>
    </div>
    <div class="info-item" style="flex:1;min-width:140px;">
      <span class="info-label">Dynamic Exit Target</span>
      <span class="info-value mono yellow" id="dynExitBps">—</span>
    </div>
    <div class="info-item" style="flex:1;min-width:140px;">
      <span class="info-label">Dynamic Hold Time</span>
      <span class="info-value mono blue" id="dynHoldSec">—</span>
    </div>
  </div>
  <table class="trade-table" id="scannerTable">
    <thead>
      <tr>
        <th>Symbol</th>
        <th>Price</th>
        <th>Vol (bps)</th>
        <th>Spread (bps)</th>
        <th>Data Pts</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody id="scannerBody">
      <tr><td colspan="6" class="empty-trades">Waiting for data...</td></tr>
    </tbody>
  </table>
</div>

<div class="section-title">Strategy Indicators</div>
<div class="info-grid" style="margin-bottom:20px;">
  <div class="info-item">
    <span class="info-label">EMA (50)</span>
    <span class="info-value mono purple" id="ema">—</span>
  </div>
  <div class="info-item">
    <span class="info-label">Momentum</span>
    <span class="info-value" id="momentum">—</span>
  </div>
  <div class="info-item">
    <span class="info-label">Inventory Skew</span>
    <span class="info-value mono" id="inventorySkew">—</span>
  </div>
  <div class="info-item">
    <span class="info-label">Status</span>
    <span class="info-value" id="stoppedStatus">—</span>
  </div>
</div>

<div class="section-title">Activity</div>
<div class="info-grid" style="margin-bottom:20px;">
  <div class="info-item">
    <span class="info-label">Uptime</span>
    <span class="info-value mono" id="uptime">—</span>
  </div>
  <div class="info-item">
    <span class="info-label">Ticks Processed</span>
    <span class="info-value mono blue" id="updates">—</span>
  </div>
  <div class="info-item">
    <span class="info-label">Starting Capital</span>
    <span class="info-value mono" id="startingCapital">—</span>
  </div>
</div>

<div class="section-title">Recent Trades</div>
<div class="trade-table-wrap">
  <table class="trade-table" id="tradeTable">
    <thead>
      <tr>
        <th>Time</th>
        <th>Side</th>
        <th>Price</th>
        <th>Qty</th>
        <th>Cum. PnL</th>
        <th>Balance</th>
      </tr>
    </thead>
    <tbody id="tradeBody">
      <tr><td colspan="6" class="empty-trades">No trades yet</td></tr>
    </tbody>
  </table>
</div>

<script>
function pnlColor(v) { return v > 0 ? 'green' : v < 0 ? 'red' : ''; }

function formatUptime(s) {
  var h = Math.floor(s / 3600);
  var m = Math.floor((s % 3600) / 60);
  var sec = Math.floor(s % 60);
  return (h > 0 ? h + 'h ' : '') + m + 'm ' + sec + 's';
}

function formatSpreadBps(spread, mid) {
  if (!mid || mid === 0) return '—';
  return ((spread / mid) * 10000).toFixed(2);
}

function formatTime(ts) {
  var d = new Date(ts * 1000);
  return d.toLocaleTimeString();
}

function update() {
  fetch('/api/status')
    .then(function(r) { return r.json(); })
    .then(function(d) {
      var dot = document.getElementById('statusDot');
      var lbl = document.getElementById('statusLabel');
      var modeBadge = document.getElementById('modeBadge');
      if (d.status === 'running') {
        dot.className = 'status-dot running';
        lbl.textContent = 'running';
      } else {
        dot.className = 'status-dot';
        lbl.textContent = 'stopped';
      }
      if (d.live_mode) {
        modeBadge.textContent = 'LIVE';
        modeBadge.className = 'mode-badge mode-live';
      } else {
        modeBadge.textContent = 'PAPER';
        modeBadge.className = 'mode-badge mode-paper';
      }

      document.getElementById('balance').textContent = '$' + d.balance.toFixed(2);
      document.getElementById('equity').textContent = '$' + d.equity.toFixed(2);

      var retEl = document.getElementById('returnPct');
      retEl.textContent = d.return_pct.toFixed(2) + '%';
      retEl.className = 'card-value mono ' + pnlColor(d.return_pct);

      document.getElementById('tradeCount').textContent = d.trade_count;

      var rpEl = document.getElementById('realizedPnl');
      rpEl.textContent = '$' + d.pnl.toFixed(4);
      rpEl.className = 'card-value mono ' + pnlColor(d.pnl);

      var upEl = document.getElementById('unrealizedPnl');
      upEl.textContent = '$' + d.unrealized_pnl.toFixed(4);
      upEl.className = 'card-value mono ' + pnlColor(d.unrealized_pnl);

      var wlEl = document.getElementById('winLoss');
      wlEl.innerHTML = '<span class="green">' + d.wins + 'W</span> / <span class="red">' + d.losses + 'L</span>';

      document.getElementById('winRate').textContent = d.win_rate.toFixed(1) + '%';
      var wrEl = document.getElementById('winRate');
      wrEl.className = 'card-value mono ' + (d.win_rate >= 50 ? 'green' : d.win_rate > 0 ? 'yellow' : '');

      document.getElementById('maxDrawdown').textContent = d.max_drawdown_pct.toFixed(2) + '%';

      document.getElementById('symbol').textContent = d.symbol;

      var tob = d.tob;
      var mid = tob.mid_price || 0;
      document.getElementById('bestBid').textContent = mid > 0 ? tob.best_bid.toFixed(2) : '—';
      document.getElementById('bestAsk').textContent = mid > 0 ? tob.best_ask.toFixed(2) : '—';
      document.getElementById('spread').textContent = formatSpreadBps(tob.spread, mid);
      document.getElementById('microprice').textContent = mid > 0 ? tob.microprice.toFixed(2) : '—';
      document.getElementById('openOrders').textContent = d.open_orders;
      document.getElementById('position').textContent = d.position.toFixed(6);

      var avgEl = document.getElementById('avgEntry');
      avgEl.textContent = d.avg_entry_price > 0 ? '$' + d.avg_entry_price.toFixed(2) : '—';

      document.getElementById('ema').textContent = d.ema > 0 ? d.ema.toFixed(2) : '—';

      var momEl = document.getElementById('momentum');
      var momClass = d.momentum === 'up' ? 'momentum-up' : d.momentum === 'down' ? 'momentum-down' : 'momentum-neutral';
      momEl.innerHTML = '<span class="momentum-badge ' + momClass + '">' + d.momentum.toUpperCase() + '</span>';

      var skewEl = document.getElementById('inventorySkew');
      var skewVal = d.position / 0.01;
      var skewDir = skewVal > 0.01 ? 'LONG bias' : skewVal < -0.01 ? 'SHORT bias' : 'Neutral';
      var skewColor = skewVal > 0.01 ? 'green' : skewVal < -0.01 ? 'red' : '';
      skewEl.textContent = skewDir + ' (' + (skewVal * 100).toFixed(0) + '%)';
      skewEl.className = 'info-value mono ' + skewColor;

      document.getElementById('uptime').textContent = formatUptime(d.uptime);
      document.getElementById('updates').textContent = d.updates_processed.toLocaleString();
      document.getElementById('startingCapital').textContent = '$' + d.starting_capital.toFixed(2);

      var reasonBadge = document.getElementById('statusReasonBadge');
      var reason = d.status_reason || 'initializing';
      var reasonLabels = {
        'active': 'ACTIVE',
        'waiting_fill': 'WAITING FOR FILL',
        'volatility_low': 'LOW VOLATILITY',
        'spread_wide': 'SPREAD TOO WIDE',
        'drawdown_stopped': 'DRAWDOWN STOPPED',
        'cooldown': 'FILL COOLDOWN',
        'time_stop': 'TIME STOP',
        'stop_loss': 'STOP LOSS',
        'initializing': 'INITIALIZING'
      };
      reasonBadge.textContent = reasonLabels[reason] || reason.toUpperCase();
      reasonBadge.className = 'status-reason-badge reason-' + reason;
      document.getElementById('spreadBps').textContent = (d.spread_bps || 0).toFixed(2);
      document.getElementById('minEdgeBps').textContent = (d.min_edge_bps || 0).toFixed(2);
      document.getElementById('feeBps').textContent = (2 * (d.fee_bps || 0)).toFixed(1);
      document.getElementById('volBps').textContent = (d.volatility_bps || 0).toFixed(2);

      document.getElementById('activePair').textContent = d.active_pair || '—';
      document.getElementById('dynExitBps').textContent = (d.dynamic_exit_bps || 0).toFixed(2) + ' bps';
      document.getElementById('dynHoldSec').textContent = (d.dynamic_hold_seconds || 0).toFixed(0) + 's';

      var scannerData = d.scanner_data || [];
      var scanBody = document.getElementById('scannerBody');
      if (scannerData.length === 0) {
        scanBody.innerHTML = '<tr><td colspan="6" class="empty-trades">Waiting for data...</td></tr>';
      } else {
        scannerData.sort(function(a, b) { return b.volatility_bps - a.volatility_bps; });
        var srows = '';
        for (var si = 0; si < scannerData.length; si++) {
          var sp = scannerData[si];
          var rowStyle = sp.active ? ' style="background:#9ece6a15;"' : '';
          srows += '<tr' + rowStyle + '>';
          srows += '<td class="mono' + (sp.active ? ' green' : '') + '">' + sp.symbol + '</td>';
          srows += '<td class="mono">' + (sp.mid_price > 0 ? '$' + sp.mid_price : '—') + '</td>';
          srows += '<td class="mono' + (sp.volatility_bps > 5 ? ' yellow' : '') + '">' + sp.volatility_bps.toFixed(2) + '</td>';
          srows += '<td class="mono">' + sp.spread_bps.toFixed(2) + '</td>';
          srows += '<td class="mono">' + sp.data_points + '</td>';
          srows += '<td>' + (sp.active ? '<span class="momentum-badge momentum-up">ACTIVE</span>' : '—') + '</td>';
          srows += '</tr>';
        }
        scanBody.innerHTML = srows;
      }

      var stEl = document.getElementById('stoppedStatus');
      if (d.is_stopped) {
        stEl.innerHTML = '<span class="stopped-badge">STOPPED — Drawdown</span>';
      } else {
        stEl.textContent = 'Active';
        stEl.className = 'info-value green';
      }

      var tbody = document.getElementById('tradeBody');
      var trades = d.trade_history || [];
      if (trades.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6" class="empty-trades">No trades yet</td></tr>';
      } else {
        var rows = '';
        for (var i = trades.length - 1; i >= 0; i--) {
          var t = trades[i];
          var rowClass = t.side === 'buy' ? 'buy-row' : 'sell-row';
          rows += '<tr class="' + rowClass + '">';
          rows += '<td class="mono">' + formatTime(t.time) + '</td>';
          rows += '<td>' + t.side.toUpperCase() + '</td>';
          rows += '<td class="mono">$' + t.price.toFixed(2) + '</td>';
          rows += '<td class="mono">' + t.qty + '</td>';
          rows += '<td class="mono">' + t.pnl.toFixed(4) + '</td>';
          rows += '<td class="mono">$' + t.balance.toFixed(2) + '</td>';
          rows += '</tr>';
        }
        tbody.innerHTML = rows;
      }
    })
    .catch(function() {
      document.getElementById('statusDot').className = 'status-dot';
      document.getElementById('statusLabel').textContent = 'disconnected';
    });
}

update();
setInterval(update, 5000);
</script>
</body>
</html>
