<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WildBot MultiPair Scalper</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    background: #1a1b26;
    color: #c0caf5;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    padding: 20px;
    min-height: 100vh;
  }
  .mono { font-family: 'JetBrains Mono', 'Fira Code', 'Consolas', monospace; }
  header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 24px;
    padding-bottom: 16px;
    border-bottom: 1px solid #363b54;
  }
  header h1 { font-size: 1.5rem; font-weight: 600; }
  .status-dot {
    width: 12px; height: 12px;
    border-radius: 50%;
    background: #f7768e;
    flex-shrink: 0;
  }
  .status-dot.running { background: #9ece6a; box-shadow: 0 0 8px #9ece6a88; }
  .status-label { font-size: 0.85rem; color: #565f89; }
  .mode-badge {
    display: inline-block;
    padding: 3px 12px;
    border-radius: 4px;
    font-size: 0.75rem;
    font-weight: 700;
    letter-spacing: 0.05em;
  }
  .mode-live { background: #f7768e22; color: #f7768e; border: 1px solid #f7768e55; }
  .mode-paper { background: #565f8922; color: #565f89; border: 1px solid #565f8955; }
  .pairs-badge {
    display: inline-block;
    padding: 3px 12px;
    border-radius: 4px;
    font-size: 0.75rem;
    font-weight: 700;
    letter-spacing: 0.05em;
    background: #7aa2f722;
    color: #7aa2f7;
    border: 1px solid #7aa2f755;
  }
  .grid { display: grid; gap: 12px; margin-bottom: 20px; }
  .grid-4 { grid-template-columns: repeat(4, 1fr); }
  .grid-5 { grid-template-columns: repeat(5, 1fr); }
  .card {
    background: #24283b;
    border-radius: 10px;
    padding: 16px;
  }
  .card-label {
    font-size: 0.7rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: #565f89;
    margin-bottom: 4px;
  }
  .card-value {
    font-size: 1.3rem;
    font-weight: 600;
    transition: color 0.3s;
  }
  .section-title {
    font-size: 0.85rem;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: #565f89;
    margin-bottom: 10px;
    font-weight: 600;
  }
  .green { color: #9ece6a; }
  .red { color: #f7768e; }
  .blue { color: #7aa2f7; }
  .yellow { color: #e0af68; }
  .purple { color: #bb9af7; }
  .info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    gap: 10px;
  }
  .info-item {
    background: #24283b;
    border-radius: 8px;
    padding: 12px;
    display: flex;
    flex-direction: column;
    gap: 3px;
  }
  .info-label { font-size: 0.68rem; text-transform: uppercase; color: #565f89; letter-spacing: 0.04em; }
  .info-value { font-size: 0.95rem; font-weight: 500; }
  .status-reason-bar {
    background: #24283b;
    border-radius: 10px;
    padding: 16px;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 12px;
    flex-wrap: wrap;
  }
  .status-reason-badge {
    display: inline-block;
    padding: 6px 16px;
    border-radius: 6px;
    font-size: 0.9rem;
    font-weight: 700;
    letter-spacing: 0.05em;
    text-transform: uppercase;
  }
  .status-summary-item {
    display: inline-block;
    padding: 4px 12px;
    border-radius: 6px;
    font-size: 0.78rem;
    font-weight: 600;
    letter-spacing: 0.04em;
    text-transform: uppercase;
  }
  .reason-active { background: #9ece6a22; color: #9ece6a; border: 1px solid #9ece6a55; }
  .reason-waiting_fill { background: #7aa2f722; color: #7aa2f7; border: 1px solid #7aa2f755; }
  .reason-volatility_low { background: #e0af6822; color: #e0af68; border: 1px solid #e0af6855; }
  .reason-spread_wide { background: #e0af6822; color: #e0af68; border: 1px solid #e0af6855; }
  .reason-drawdown_stopped { background: #f7768e22; color: #f7768e; border: 1px solid #f7768e55; }
  .reason-cooldown { background: #bb9af722; color: #bb9af7; border: 1px solid #bb9af755; }
  .reason-time_stop { background: #f7768e22; color: #f7768e; border: 1px solid #f7768e55; }
  .reason-stop_loss { background: #f7768e22; color: #f7768e; border: 1px solid #f7768e55; }
  .reason-initializing { background: #565f8922; color: #565f89; border: 1px solid #565f8955; }
  .trading-badge {
    display: inline-block;
    padding: 2px 10px;
    border-radius: 4px;
    font-size: 0.8rem;
    font-weight: 600;
    background: #7aa2f722;
    color: #7aa2f7;
    border: 1px solid #7aa2f755;
  }
  .stopped-badge {
    display: inline-block;
    background: #f7768e22;
    color: #f7768e;
    padding: 2px 10px;
    border-radius: 4px;
    font-size: 0.85rem;
    font-weight: 600;
  }
  .momentum-badge {
    display: inline-block;
    padding: 2px 10px;
    border-radius: 4px;
    font-size: 0.8rem;
    font-weight: 600;
  }
  .momentum-up { background: #9ece6a22; color: #9ece6a; }
  .momentum-down { background: #f7768e22; color: #f7768e; }
  .momentum-neutral { background: #565f8922; color: #565f89; }
  .trade-table-wrap {
    background: #24283b;
    border-radius: 10px;
    padding: 16px;
    margin-bottom: 20px;
    overflow-x: auto;
  }
  .trade-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.82rem;
  }
  .trade-table th {
    text-align: left;
    padding: 8px 10px;
    color: #565f89;
    font-size: 0.7rem;
    text-transform: uppercase;
    letter-spacing: 0.04em;
    border-bottom: 1px solid #363b54;
  }
  .trade-table td {
    padding: 6px 10px;
    border-bottom: 1px solid #1a1b26;
  }
  .trade-table tr:last-child td { border-bottom: none; }
  .trade-table .buy-row { color: #9ece6a; }
  .trade-table .sell-row { color: #f7768e; }
  .position-row { background: #7aa2f710; }
  .empty-trades {
    color: #565f89;
    text-align: center;
    padding: 24px;
    font-size: 0.85rem;
  }
  @media (max-width: 900px) {
    .grid-4 { grid-template-columns: repeat(2, 1fr); }
    .grid-5 { grid-template-columns: repeat(2, 1fr); }
  }
  @media (max-width: 480px) {
    .grid-4 { grid-template-columns: 1fr; }
    .grid-5 { grid-template-columns: 1fr; }
  }
</style>
</head>
<body>
<header>
  <div class="status-dot" id="statusDot"></div>
  <h1>WildBot MultiPair Scalper</h1>
  <span class="status-label" id="statusLabel">connecting...</span>
  <span class="mode-badge" id="modeBadge">—</span>
  <span class="pairs-badge" id="pairsBadge">0/0 pairs</span>
</header>

<div class="status-reason-bar" id="statusReasonBar">
  <span class="status-summary-item reason-initializing">INITIALIZING</span>
</div>

<div class="grid grid-4">
  <div class="card">
    <div class="card-label">Balance</div>
    <div class="card-value mono" id="balance">—</div>
  </div>
  <div class="card">
    <div class="card-label">Equity</div>
    <div class="card-value mono" id="equity">—</div>
  </div>
  <div class="card">
    <div class="card-label">Return %</div>
    <div class="card-value mono" id="returnPct">—</div>
  </div>
  <div class="card">
    <div class="card-label">Trade Count</div>
    <div class="card-value mono blue" id="tradeCount">—</div>
  </div>
</div>

<div class="grid grid-5">
  <div class="card">
    <div class="card-label">Realized PnL</div>
    <div class="card-value mono" id="realizedPnl">—</div>
  </div>
  <div class="card">
    <div class="card-label">Total Fees</div>
    <div class="card-value mono red" id="totalFees">—</div>
  </div>
  <div class="card">
    <div class="card-label">Win / Loss</div>
    <div class="card-value mono" id="winLoss">—</div>
  </div>
  <div class="card">
    <div class="card-label">Win Rate %</div>
    <div class="card-value mono" id="winRate">—</div>
  </div>
  <div class="card">
    <div class="card-label">Active Pairs</div>
    <div class="card-value mono blue" id="activePairCount">—</div>
  </div>
</div>

<div class="section-title">Active Pairs</div>
<div class="trade-table-wrap" style="margin-bottom:20px;">
  <table class="trade-table" id="activePairsTable">
    <thead>
      <tr>
        <th>Symbol</th>
        <th>Status</th>
        <th>Bid / Ask</th>
        <th>Position</th>
        <th>Avg Entry</th>
        <th>PnL</th>
        <th>Unrealized</th>
        <th>Orders</th>
        <th>Vol (bps)</th>
      </tr>
    </thead>
    <tbody id="activePairsBody">
      <tr><td colspan="9" class="empty-trades">No active pairs</td></tr>
    </tbody>
  </table>
</div>

<div class="section-title">Pair Scanner</div>
<div class="trade-table-wrap" style="margin-bottom:20px;">
  <table class="trade-table" id="scannerTable">
    <thead>
      <tr>
        <th>Symbol</th>
        <th>Price</th>
        <th>Vol (bps)</th>
        <th>Spread (bps)</th>
        <th>Data Pts</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody id="scannerBody">
      <tr><td colspan="6" class="empty-trades">Waiting for data...</td></tr>
    </tbody>
  </table>
</div>

<div class="section-title">Activity</div>
<div class="info-grid" style="margin-bottom:20px;">
  <div class="info-item">
    <span class="info-label">Uptime</span>
    <span class="info-value mono" id="uptime">—</span>
  </div>
  <div class="info-item">
    <span class="info-label">Starting Capital</span>
    <span class="info-value mono" id="startingCapital">—</span>
  </div>
</div>

<div class="section-title">Recent Trades</div>
<div class="trade-table-wrap">
  <table class="trade-table" id="tradeTable">
    <thead>
      <tr>
        <th>Time</th>
        <th>Pair</th>
        <th>Side</th>
        <th>Price</th>
        <th>Qty</th>
        <th>Cum. PnL</th>
        <th>Balance</th>
      </tr>
    </thead>
    <tbody id="tradeBody">
      <tr><td colspan="7" class="empty-trades">No trades yet</td></tr>
    </tbody>
  </table>
</div>

<script>
function pnlColor(v) { return v > 0 ? 'green' : v < 0 ? 'red' : ''; }

function formatUptime(s) {
  var h = Math.floor(s / 3600);
  var m = Math.floor((s % 3600) / 60);
  var sec = Math.floor(s % 60);
  return (h > 0 ? h + 'h ' : '') + m + 'm ' + sec + 's';
}

function formatTime(ts) {
  var d = new Date(ts * 1000);
  return d.toLocaleTimeString();
}

var reasonLabels = {
  'active': 'ACTIVE',
  'waiting_fill': 'WAITING FILL',
  'volatility_low': 'LOW VOL',
  'spread_wide': 'WIDE SPREAD',
  'drawdown_stopped': 'DRAWDOWN',
  'cooldown': 'COOLDOWN',
  'time_stop': 'TIME STOP',
  'stop_loss': 'STOP LOSS',
  'initializing': 'INITIALIZING'
};

function update() {
  fetch('/api/status')
    .then(function(r) { return r.json(); })
    .then(function(d) {
      var dot = document.getElementById('statusDot');
      var lbl = document.getElementById('statusLabel');
      var modeBadge = document.getElementById('modeBadge');
      if (d.status === 'running') {
        dot.className = 'status-dot running';
        lbl.textContent = 'running';
      } else {
        dot.className = 'status-dot';
        lbl.textContent = 'stopped';
      }
      if (d.live_mode) {
        modeBadge.textContent = 'LIVE';
        modeBadge.className = 'mode-badge mode-live';
      } else {
        modeBadge.textContent = 'PAPER';
        modeBadge.className = 'mode-badge mode-paper';
      }

      var activePairs = d.active_pairs || [];
      var maxPairs = d.max_active_pairs || 0;
      document.getElementById('pairsBadge').textContent = activePairs.length + '/' + maxPairs + ' pairs';

      document.getElementById('balance').textContent = '$' + (d.total_balance || 0).toFixed(2);
      document.getElementById('equity').textContent = '$' + (d.total_equity || 0).toFixed(2);

      var retEl = document.getElementById('returnPct');
      var retVal = d.return_pct || 0;
      retEl.textContent = retVal.toFixed(2) + '%';
      retEl.className = 'card-value mono ' + pnlColor(retVal);

      document.getElementById('tradeCount').textContent = d.total_trades || 0;

      var rpEl = document.getElementById('realizedPnl');
      var pnlVal = d.total_pnl || 0;
      rpEl.textContent = '$' + pnlVal.toFixed(4);
      rpEl.className = 'card-value mono ' + pnlColor(pnlVal);

      document.getElementById('totalFees').textContent = '$' + (d.total_fees || 0).toFixed(4);

      var wlEl = document.getElementById('winLoss');
      wlEl.innerHTML = '<span class="green">' + (d.total_wins || 0) + 'W</span> / <span class="red">' + (d.total_losses || 0) + 'L</span>';

      var wrVal = d.win_rate || 0;
      var wrEl = document.getElementById('winRate');
      wrEl.textContent = wrVal.toFixed(1) + '%';
      wrEl.className = 'card-value mono ' + (wrVal >= 50 ? 'green' : wrVal > 0 ? 'yellow' : '');

      document.getElementById('activePairCount').textContent = activePairs.length;

      var statusCounts = {};
      var activeSymbols = {};
      for (var pi = 0; pi < activePairs.length; pi++) {
        var p = activePairs[pi];
        var sr = p.status_reason || 'active';
        statusCounts[sr] = (statusCounts[sr] || 0) + 1;
        activeSymbols[p.symbol] = true;
      }

      var statusBar = document.getElementById('statusReasonBar');
      if (activePairs.length === 0) {
        statusBar.innerHTML = '<span class="status-summary-item reason-initializing">NO ACTIVE PAIRS</span>';
      } else {
        var statusHtml = '';
        for (var reason in statusCounts) {
          var label = reasonLabels[reason] || reason.toUpperCase();
          statusHtml += '<span class="status-summary-item reason-' + reason + '">' + statusCounts[reason] + ' ' + label + '</span>';
        }
        statusBar.innerHTML = statusHtml;
      }

      var apBody = document.getElementById('activePairsBody');
      if (activePairs.length === 0) {
        apBody.innerHTML = '<tr><td colspan="9" class="empty-trades">No active pairs</td></tr>';
      } else {
        var apRows = '';
        for (var ai = 0; ai < activePairs.length; ai++) {
          var ap = activePairs[ai];
          var hasPos = ap.position && ap.position !== 0;
          var rowCls = hasPos ? ' class="position-row"' : '';
          var tob = ap.tob || {};
          var bidAsk = (tob.bid ? tob.bid.toFixed(6) : '—') + ' / ' + (tob.ask ? tob.ask.toFixed(6) : '—');
          var apReason = ap.status_reason || 'active';
          var apReasonLabel = reasonLabels[apReason] || apReason.toUpperCase();

          apRows += '<tr' + rowCls + '>';
          apRows += '<td class="mono blue">' + ap.symbol + '</td>';
          apRows += '<td><span class="status-summary-item reason-' + apReason + '">' + apReasonLabel + '</span></td>';
          apRows += '<td class="mono"><span class="green">' + (tob.bid ? tob.bid.toFixed(6) : '—') + '</span> / <span class="red">' + (tob.ask ? tob.ask.toFixed(6) : '—') + '</span></td>';
          apRows += '<td class="mono' + (hasPos ? (ap.position > 0 ? ' green' : ' red') : '') + '">' + (ap.position || 0).toFixed(4) + '</td>';
          apRows += '<td class="mono yellow">' + (ap.avg_entry_price > 0 ? '$' + ap.avg_entry_price.toFixed(6) : '—') + '</td>';
          apRows += '<td class="mono ' + pnlColor(ap.pnl) + '">' + (ap.pnl || 0).toFixed(4) + '</td>';
          apRows += '<td class="mono ' + pnlColor(ap.unrealized_pnl) + '">' + (ap.unrealized_pnl || 0).toFixed(4) + '</td>';
          apRows += '<td class="mono blue">' + (ap.open_orders || 0) + '</td>';
          apRows += '<td class="mono' + ((ap.volatility_bps || 0) > 5 ? ' yellow' : '') + '">' + (ap.volatility_bps || 0).toFixed(2) + '</td>';
          apRows += '</tr>';
        }
        apBody.innerHTML = apRows;
      }

      document.getElementById('uptime').textContent = formatUptime(d.uptime || 0);
      var scEl = document.getElementById('startingCapital');
      if (d.starting_capital !== undefined) {
        scEl.textContent = '$' + d.starting_capital.toFixed(2);
      }

      var scannerData = d.scanner_data || [];
      var scanBody = document.getElementById('scannerBody');
      if (scannerData.length === 0) {
        scanBody.innerHTML = '<tr><td colspan="6" class="empty-trades">Waiting for data...</td></tr>';
      } else {
        scannerData.sort(function(a, b) { return b.volatility_bps - a.volatility_bps; });
        var srows = '';
        for (var si = 0; si < scannerData.length; si++) {
          var sp = scannerData[si];
          var isTrading = activeSymbols[sp.symbol] || false;
          var rowStyle = isTrading ? ' style="background:#7aa2f715;"' : (sp.active ? ' style="background:#9ece6a15;"' : '');
          srows += '<tr' + rowStyle + '>';
          srows += '<td class="mono' + (isTrading ? ' blue' : sp.active ? ' green' : '') + '">' + sp.symbol + '</td>';
          srows += '<td class="mono">' + (sp.mid_price > 0 ? '$' + sp.mid_price : '—') + '</td>';
          srows += '<td class="mono' + (sp.volatility_bps > 5 ? ' yellow' : '') + '">' + sp.volatility_bps.toFixed(2) + '</td>';
          srows += '<td class="mono">' + sp.spread_bps.toFixed(2) + '</td>';
          srows += '<td class="mono">' + sp.data_points + '</td>';
          if (isTrading) {
            srows += '<td><span class="trading-badge">TRADING</span></td>';
          } else if (sp.active) {
            srows += '<td><span class="momentum-badge momentum-up">ACTIVE</span></td>';
          } else {
            srows += '<td>—</td>';
          }
          srows += '</tr>';
        }
        scanBody.innerHTML = srows;
      }

      var tbody = document.getElementById('tradeBody');
      var trades = d.trade_history || [];
      if (trades.length === 0) {
        tbody.innerHTML = '<tr><td colspan="7" class="empty-trades">No trades yet</td></tr>';
      } else {
        var rows = '';
        for (var i = trades.length - 1; i >= 0; i--) {
          var t = trades[i];
          var rowClass = t.side === 'buy' ? 'buy-row' : 'sell-row';
          rows += '<tr class="' + rowClass + '">';
          rows += '<td class="mono">' + formatTime(t.time) + '</td>';
          rows += '<td class="mono blue">' + (t.symbol || '—') + '</td>';
          rows += '<td>' + t.side.toUpperCase() + '</td>';
          rows += '<td class="mono">$' + t.price.toFixed(2) + '</td>';
          rows += '<td class="mono">' + t.qty + '</td>';
          rows += '<td class="mono">' + t.pnl.toFixed(4) + '</td>';
          rows += '<td class="mono">$' + t.balance.toFixed(2) + '</td>';
          rows += '</tr>';
        }
        tbody.innerHTML = rows;
      }
    })
    .catch(function() {
      document.getElementById('statusDot').className = 'status-dot';
      document.getElementById('statusLabel').textContent = 'disconnected';
    });
}

update();
setInterval(update, 5000);
</script>
</body>
</html>
